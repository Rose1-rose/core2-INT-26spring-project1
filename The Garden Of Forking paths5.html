<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="text.css" />
    <link rel="stylesheet" href="garden.css" />

  <title>Puzzle Text</title>

  <!-- 防闪 + preload -->
  <style>
    html{ background:#0f0f3d; }
    body{ opacity:0; transition: opacity 180ms ease; }
    body.ready{ opacity:1; }
  </style>
</head>
<body>
  <header class="bar">
    <a class="back" href="index.html">← Back</a>
  </header>

  <main class="page">
    <P class="puzzle">
        We sat down, I upon a large, low divan, he with his back to the window and to a 
large circular clock. I calculated that my pursuer, Richard Madden, could not arrive in 
less than an hour. My irrevocable decision could wait. 
    </P>
    <P class="puzzle">
        "A strange destiny," said Stephen Albert, "that of Ts'ui Pen - Governor of his native 
province, learned in astronomy, in astrology and tireless in the interpretation of the 
canonical books, a chess player, a famous poet and a calligrapher. Yet he abandoned 
all to make a book and a labyrinth. He gave up all the pleasures of oppression, 
justice, of a well-stocked bed, of banquets, and even of erudition, and shut himself up 
in the Pavilion of the Limpid Sun for thirteen years. At his death, his heirs found only 
a mess of manuscripts. The family, as you doubtless know, wished to consign them 
to the fire, but the executor of the estate - a Taoist or a Buddhist monk - insisted on 
their publication." 
    </P>
    <P class="puzzle">
        "Those of the blood of Ts'ui Pen," I replied, "still curse the memory of that monk. 
Such a publication was madness. The book is a shapeless mass of contradictory 
rough drafts. I examined it once upon a time: the hero dies in the third chapter, 
while in the fourth he is alive. As for that other enterprise of Ts'ui Pen ... his 
Labyrinth . . ." 
    </P>
    <P class="puzzle">
        "Here is the Labyrinth," Albert said, pointing to a tall, laquered writing cabinet. 
    </P>
    <P class="puzzle">
        "An ivory labyrinth?" I exclaimed. "A tiny labyrinth indeed . . . !" 
    </P>
    <P class="puzzle">
        "A symbolic labyrinth," he corrected me. "An invisible labyrinth of time. I, a 
barbarous Englishman, have been given the key to this transparent mystery. After 
more than a hundred years most of the details are irrecoverable, lost beyond all 
recall, but it isn't hard to image what must have happened. At one time, Ts'ui Pen 
must have said; 'I am going into seclusion to write a book,' and at another, 'I am 
retiring to construct a maze.' Everyone assumed these were separate activities. No 
one realized that the book and the labyrinth were one and the same. The Pavilion of 
the Limpid Sun was set in the middle of an intricate garden. This may have suggested 
the idea of a physical maze.
    </P>
    <P class="puzzle">
        "Ts'ui Pen died. In all the vast lands which once belonged to your family, no one 
could find the labyrinth. The novel's confusion suggested that it was the labyrinth. 
    </P>
    <P class="puzzle">
        Two circumstances showed me the direct solution to the problem. First, the curious 
legend that Ts'ui Pen had proposed to create an infinite maze, second, a fragment of 
a letter which I discovered." 
    </P>
    <P class="puzzle">
        Albert rose. For a few moments he turned his back to me. He opened the top 
drawer in the high black and gilded writing cabinet. He returned holding in his hand a 
piece of paper which had once been crimson but which had faded with the passage 
of time: it was rose colored, tenuous, quadrangular. Ts'ui Pen's calligraphy was justly 
famous. Eagerly, but without understanding, I read the words which a man of my 
own blood had written with a small brush: "I leave to various future times, but not 
to all, my garden of forking paths." 
    </P>
    </main>
<!-- JS 放在 body 最底部 -->
  <script>
    // ✅ 先显示页面（避免永远透明）
    window.addEventListener('load', () => {
      document.body.classList.add('ready');
    });

    const chunkSize = 26;

    function splitIntoChunks(text, size) {
      const clean = text.replace(/\s+/g, ' ').trim();
      const chunks = [];
      let i = 0;
      while (i < clean.length) {
        let end = Math.min(i + size, clean.length);
        if (end < clean.length) {
          const lastSpace = clean.lastIndexOf(' ', end);
          if (lastSpace > i + 8) end = lastSpace;
        }
        chunks.push(clean.slice(i, end));
        i = end + 1;
      }
      return chunks;
    }

    function randomFromSides() {
      const side = Math.floor(Math.random() * 4);
      const dist = 140 + Math.random() * 220;
      let dx = 0, dy = 0;
      if (side === 0) { dy = -dist; dx = (Math.random() - 0.5) * dist; }
      if (side === 1) { dx =  dist; dy = (Math.random() - 0.5) * dist; }
      if (side === 2) { dy =  dist; dx = (Math.random() - 0.5) * dist; }
      if (side === 3) { dx = -dist; dy = (Math.random() - 0.5) * dist; }
      return { dx, dy };
    }

    function buildPuzzleParagraph(p) {
      const original = p.textContent;
      const parts = splitIntoChunks(original, chunkSize);
      p.textContent = '';
      p.classList.add('puzzle-ready');

      parts.forEach((part, i) => {
        const span = document.createElement('span');
        span.className = 'piece';
        span.textContent = part + ' ';

        const { dx, dy } = randomFromSides();
        const rot = (Math.random() - 0.5) * 18;
        const delay = i * 55 + Math.random() * 60;

        span.style.setProperty('--dx', dx.toFixed(0) + 'px');
        span.style.setProperty('--dy', dy.toFixed(0) + 'px');
        span.style.setProperty('--rot', rot.toFixed(1) + 'deg');
        span.style.setProperty('--delay', delay.toFixed(0) + 'ms');

        p.appendChild(span);
      });
    }

    const puzzles = document.querySelectorAll('p.puzzle');
    puzzles.forEach(buildPuzzleParagraph);

    const io = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          io.unobserve(entry.target);
        }
      });
    }, { threshold: 0.25 });

    puzzles.forEach(p => io.observe(p));
  </script>
</body>
</html>