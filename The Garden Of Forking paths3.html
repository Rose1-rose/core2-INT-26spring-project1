<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="text.css" />
</head>
<body>
  <header class="bar">
    <a class="back" href="index.html">← Back</a>
  </header>

  <main class="page">
     <p class="puzzle">
    that were it not for the precious accident of the train schedule, I 
would be in prison or dead. I argued, with no less sophism, that my timorous 
happiness was proof that I was man enough to bring this adventure to a successful 
conclusion. From my weakness I drew strength that never left me. 
     </p>
 <p class="puzzle">
     I foresee that man will resign himself each day to new abominations, that soon only 
soldiers and bandits will be left. To them I offer this advice: Whosoever would 
undertake some atrocious enterprise should act as if it were already accomplished, 
should impose upon himself a future as irrevocable as the past. 
     </p>
    <p class="puzzle">
       Thus I proceeded, while with the eyes of a man already dead, I contemplated the 
fluctuations of the day which would probably be my last, and watched the diffuse 
coming of night. 
    </p>
    <p class="puzzle">
The train crept along gently, amid ash trees. It slowed down and stopped, almost in 
the middle of a field. No one called the name of a station. "Ashgrove?" I asked some 
children on the platform. "Ashgrove," they replied. I got out. 
    </p>
    <p class="puzzle">
        A lamp lit the platform, but the children's faces remained in a shadow. One of them 
asked me: "Are you going to Dr. Stephen Albert's house?" Without waiting for my 
answer, another said: "The house is a good distance away but you won't get lost if 
you take the road to the left and bear to the left at every crossroad." I threw them a 
coin (my last), went down some stone steps and started along a deserted road. At a 
slight incline, the road ran downhill. It was a plain dirt way, and overhead the 
branches of trees intermingled, while a round moon hung low in the sky as if to keep 
me company.
    </p>
    <P class="puzzle">
        For a moment I thought that Richard Madden might in some way have divined my 
desperate intent. At once I realized that this would be impossible. The advice about 
turning always to the left reminded me that such was the common formula for 
finding the central courtyard of certain labyrinths. I know something about 
labyrinths. Not for nothing am I the greatgrandson of Ts'ui Pen. He was Governor of 
Yunnan and gave up temporal power to write a novel with more characters than 
there are in the Hung Lou Meng, and to create a maze in which all men would lose 
themselves. He spent thirteen years on these oddly assorted tasks before he was 
assassinated by a stranger. His novel had no sense to it and nobody ever found his 
labyrinth. 
 </P>
 <P class="puzzle">
    Under the trees of England I meditated on this lost and perhaps mythical labyrinth. I 
imagined it untouched and perfect on the secret summit of some mountain; I 
imagined it drowned under rice paddies or beneath the sea; I imagined it infinite, 
made not only of eight-sided pavilions and of twisting paths but also of rivers, 
provinces and kingdoms ... I thought of a maze of mazes, of a sinuous, ever growing 
maze which would take in both past and future and would somehow involve the 
stars. 
 </P>
 <P class="puzzle">
    Lost in these imaginary illusions I forgot my destiny - that of the hunted. For an 
undetermined period of time I felt myself cut off from the world, an abstract 
spectator. The hazy and murmuring countryside, the moon, the decline of the 
evening, stirred within me. Going down the gently sloping road I could not feel 
fatigue. The evening was at once intimate and infinite. 
 </P>
    </main>
</body>
</html>
<!-- JS 放在 body 最底部 -->
  <script>
    /**
     * 把<p class="puzzle">里的纯文本切成“碎片span”
     * 你可以调 chunkSize 来控制每片的长度（越小越碎，越像拼图）
     */
    const chunkSize = 26; // 每片大概多少字符（建议 18-32）

    function splitIntoChunks(text, size) {
      const clean = text.replace(/\s+/g, ' ').trim();
      const chunks = [];
      let i = 0;

      while (i < clean.length) {
        // 尽量在空格处断开，不要硬切断单词
        let end = Math.min(i + size, clean.length);
        if (end < clean.length) {
          const lastSpace = clean.lastIndexOf(' ', end);
          if (lastSpace > i + 8) end = lastSpace; // 8 是防止切得太短
        }
        chunks.push(clean.slice(i, end));
        i = end + 1;
      }
      return chunks;
    }

    function randomFromSides() {
      // 0上 1右 2下 3左
      const side = Math.floor(Math.random() * 4);
      const dist = 140 + Math.random() * 220;
      let dx = 0, dy = 0;

      if (side === 0) { dy = -dist; dx = (Math.random() - 0.5) * dist; }
      if (side === 1) { dx =  dist; dy = (Math.random() - 0.5) * dist; }
      if (side === 2) { dy =  dist; dx = (Math.random() - 0.5) * dist; }
      if (side === 3) { dx = -dist; dy = (Math.random() - 0.5) * dist; }

      return { dx, dy };
    }

    function buildPuzzleParagraph(p) {
      const original = p.textContent;
      const parts = splitIntoChunks(original, chunkSize);

      p.textContent = ''; // 清空
      p.classList.add('puzzle-ready');

      parts.forEach((part, i) => {
        const span = document.createElement('span');
        span.className = 'piece';
        span.textContent = part + ' '; // 保留空格

        const { dx, dy } = randomFromSides();
        const rot = (Math.random() - 0.5) * 18; // -9deg ~ 9deg
        const delay = i * 55 + Math.random() * 60; // 拼图节奏

        span.style.setProperty('--dx', dx.toFixed(0) + 'px');
        span.style.setProperty('--dy', dy.toFixed(0) + 'px');
        span.style.setProperty('--rot', rot.toFixed(1) + 'deg');
        span.style.setProperty('--delay', delay.toFixed(0) + 'ms');

        p.appendChild(span);
      });
    }

    // 1) 先把所有 puzzle 段落构造成碎片
    const puzzles = document.querySelectorAll('p.puzzle');
    puzzles.forEach(buildPuzzleParagraph);

    // 2) 滚动到时触发一次拼合
    const io = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          io.unobserve(entry.target);
        }
      });
    }, { threshold: 0.25 });

    puzzles.forEach(p => io.observe(p));
  </script>

</body>
</html>
