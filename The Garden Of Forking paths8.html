<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="text.css" />
    <link rel="stylesheet" href="garden.css" />

  <title>Puzzle Text</title>

  <style>
    html{ background:#0f0f3d; }
    body{ opacity:0; transition: opacity 180ms ease; }
    body.ready{ opacity:1; }
  </style>
</head>
<body>
  <header class="bar">
    <a class="back" href="index.html">‚Üê Back</a>
  </header>

  <main class="page">
    <P class="puzzle">
        "Not in all," he murmured with a smile. "Time is forever dividing itself toward 
innumerable futures and in one of them I am your enemy." 
    </P>
    <P class="puzzle">
        Once again I sensed the pullulation of which I have already spoken. It seemed to me 
that the dew-damp garden surrounding the house was infinitely saturated with 
invisible people. All were Albert and myself, secretive, busy and multiform in other 
dimensions of time. I lifted my eyes and the short nightmare disappeared. In the 
black and yellow garden there was only a single man, but this man was as strong as a 
statue and this man was walking up the path and he was Captain Richard Madden. 
    </P>
    <P class="puzzle">
        "The future exists now," I replied. "But I am your friend. Can I take another look at 
the letter?" 
    </P>
    <P class="puzzle">
        Albert rose from his seat. He stood up tall as he opened the top drawer of the high 
writing cabinet. For a moment his back was again turned to me. I had the revolver 
ready. I fired with the utmost care: Albert fell without a murmur, at once. I swear 
that his death was instantaneous, as if he had been struck by lightning. 
    </P>
    <P class="puzzle">
        What remains is unreal and unimportant. Madden broke in and arrested me. I have 
been condemned to hang. Abominably, I have yet triumphed! The secret name of the 
city to be attacked got through to Berlin. Yesterday it was bombed. I read the news 
in the same English newspapers which were trying to solve the riddle of the murder 
of the learned Sinologist Stephen Albert by the unknown Yu Tsun. The Chief, 
however, had already solved this mystery. He knew that my problem was to shout, 
with my feeble voice, above the tumult of war, the name of the city called Albert, 
and that I had no other course open to me than to kill someone of that name. He 
does not know, for no one can, of my infinite penitence and sickness of the heart. 
    </P>
    <P class="puzzle">
        ' A malicious and outlandish statement. In point of fact, Captain Richard Madden had been attacked by the 
Prussian spy Hans Rabener, alias Viktor Runeberg, who drew an automatic pistol when Madden appeared with 
orders for the spy's arrest. Madden, in self defense, had inflicted wounds of which the spy later died. - Note by 
the manuscript editor. 
    </P>
     </main>
<script>
  
    window.addEventListener('load', () => {
      document.body.classList.add('ready');
    });

    const chunkSize = 26;

    function splitIntoChunks(text, size) {
      const clean = text.replace(/\s+/g, ' ').trim();
      const chunks = [];
      let i = 0;
      while (i < clean.length) {
        let end = Math.min(i + size, clean.length);
        if (end < clean.length) {
          const lastSpace = clean.lastIndexOf(' ', end);
          if (lastSpace > i + 8) end = lastSpace;
        }
        chunks.push(clean.slice(i, end));
        i = end + 1;
      }
      return chunks;
    }

    function randomFromSides() {
      const side = Math.floor(Math.random() * 4);
      const dist = 140 + Math.random() * 220;
      let dx = 0, dy = 0;
      if (side === 0) { dy = -dist; dx = (Math.random() - 0.5) * dist; }
      if (side === 1) { dx =  dist; dy = (Math.random() - 0.5) * dist; }
      if (side === 2) { dy =  dist; dx = (Math.random() - 0.5) * dist; }
      if (side === 3) { dx = -dist; dy = (Math.random() - 0.5) * dist; }
      return { dx, dy };
    }

    function buildPuzzleParagraph(p) {
      const original = p.textContent;
      const parts = splitIntoChunks(original, chunkSize);
      p.textContent = '';
      p.classList.add('puzzle-ready');

      parts.forEach((part, i) => {
        const span = document.createElement('span');
        span.className = 'piece';
        span.textContent = part + ' ';

        const { dx, dy } = randomFromSides();
        const rot = (Math.random() - 0.5) * 18;
        const delay = i * 55 + Math.random() * 60;

        span.style.setProperty('--dx', dx.toFixed(0) + 'px');
        span.style.setProperty('--dy', dy.toFixed(0) + 'px');
        span.style.setProperty('--rot', rot.toFixed(1) + 'deg');
        span.style.setProperty('--delay', delay.toFixed(0) + 'ms');

        p.appendChild(span);
      });
    }

    const puzzles = document.querySelectorAll('p.puzzle');
    puzzles.forEach(buildPuzzleParagraph);

    const io = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          io.unobserve(entry.target);
        }
      });
    }, { threshold: 0.25 });

    puzzles.forEach(p => io.observe(p));
  </script>
</body>
</html>

