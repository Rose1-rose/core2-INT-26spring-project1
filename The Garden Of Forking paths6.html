<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="text.css" />
    <link rel="stylesheet" href="garden.css" />

  <title>Puzzle Text</title>

  <style>
    html{ background:#0f0f3d; }
    body{ opacity:0; transition: opacity 180ms ease; }
    body.ready{ opacity:1; }
  </style>

</head>
<body>
  <header class="bar">
    <a class="back" href="index.html">‚Üê Back</a>
  </header>

  <main class="page">
    <P class="puzzle">
        "Before I discovered this letter, I kept asking myself how a book could be infinite. I 
could not imagine any other than a cyclic volume, circular. A volume whose last page 
would be the same as the first and so have the possibility of continuing indefinitely. I 
recalled, too, the night in the middle of The Thousand and One Nights when Queen 
Scheherezade, through a magical mistake on the part of her copyist, started to tell 
the story of The Thousand and One Nights, with the risk of again arriving at the 
night upon which she will relate it, and thus on to infinity. I also imagined a Platonic 
hereditary work, passed on from father to son, to which each individual would add a 
new chapter or correct, with pious care, the work of his elders.
    </P>
    <P class="puzzle">
        "These conjectures gave me amusement, but none seemed to have the remotest 
application to the contradictory chapters of Ts'ui Pen. At this point, I was sent from 
Oxford the manuscript you have just seen. 
    </P>
    <P class="puzzle">
        "Naturally, my attention was caught by the sentence, 'I leave to various future times, 
but not to all, my garden of forking paths: I had no sooner read this, than I 
understood. The Garden of Forking Paths was the chaotic novel itself. The phrase 'to 
various future times, but not to all' suggested the image of bifurcating in time, not in 
space. Rereading the whole work confirmed this theory. In all fiction, when a man is 
faced with alternatives he chooses one at the expense of the others. In the almost 
unfathomable Ts'ui Pen, he chooses - simultaneously - all of them. He thus creates 
various futures, various times which start others that will in their turn branch out 
and bifurcate in other times. This is the cause of the contradictions in the novel. 
    </P>
    <P class="puzzle">
        "Fang, let us say, has a secret. A stranger knocks at his door. Fang makes up his mind 
to kill him. Naturally there are various possible outcomes. Fang can kill the intruder, 
the intruder can kill Fang, both can be saved, both can die and so on and so on. In 
Ts'ui Pen's work, all the possible solutions occur, each one being the point of 
departure for other bifurcations. Sometimes the pathways of this labyrinth converge. 
For example, you come to this house; but in other possible pasts you are my enemy; 
in others my friend. 
    </P>
    <P class="puzzle">
        "If you will put up with my atrocious pronunciation, I would like to read you a few 
pages of your ancestor's work." 
    </P>
    <P class="puzzle">
        His countenance, in the bright circle of lamplight, was certainly that of an ancient, but 
it shone with something unyielding, even immortal. 
    </P>
    <P class="puzzle">
        With slow precision, he read two versions of the same epic chapter. In the first, an 
army marches into battle over a desolate mountain pass. The bleak and somber 
aspect of the rocky landscape made the soldiers feel that life itself was of little value, 
and so they won the battle easily. In the second, the same army passes through a 
palace where a banquet is in progress. The splendor of the feast remained a memory 
throughout the glorious battle, and so victory followed. 
    </P>
    <P class="puzzle">
        With proper veneration I listened to these old tales, although perhaps with less 
admiration for them in themselves than for the fact that they had been thought out 
by one of my own blood, and that a man of a distant empire had given them back to 
    </P>
    </main>
<script>
 
    window.addEventListener('load', () => {
      document.body.classList.add('ready');
    });

    const chunkSize = 26;

    function splitIntoChunks(text, size) {
      const clean = text.replace(/\s+/g, ' ').trim();
      const chunks = [];
      let i = 0;
      while (i < clean.length) {
        let end = Math.min(i + size, clean.length);
        if (end < clean.length) {
          const lastSpace = clean.lastIndexOf(' ', end);
          if (lastSpace > i + 8) end = lastSpace;
        }
        chunks.push(clean.slice(i, end));
        i = end + 1;
      }
      return chunks;
    }

    function randomFromSides() {
      const side = Math.floor(Math.random() * 4);
      const dist = 140 + Math.random() * 220;
      let dx = 0, dy = 0;
      if (side === 0) { dy = -dist; dx = (Math.random() - 0.5) * dist; }
      if (side === 1) { dx =  dist; dy = (Math.random() - 0.5) * dist; }
      if (side === 2) { dy =  dist; dx = (Math.random() - 0.5) * dist; }
      if (side === 3) { dx = -dist; dy = (Math.random() - 0.5) * dist; }
      return { dx, dy };
    }

    function buildPuzzleParagraph(p) {
      const original = p.textContent;
      const parts = splitIntoChunks(original, chunkSize);
      p.textContent = '';
      p.classList.add('puzzle-ready');

      parts.forEach((part, i) => {
        const span = document.createElement('span');
        span.className = 'piece';
        span.textContent = part + ' ';

        const { dx, dy } = randomFromSides();
        const rot = (Math.random() - 0.5) * 18;
        const delay = i * 55 + Math.random() * 60;

        span.style.setProperty('--dx', dx.toFixed(0) + 'px');
        span.style.setProperty('--dy', dy.toFixed(0) + 'px');
        span.style.setProperty('--rot', rot.toFixed(1) + 'deg');
        span.style.setProperty('--delay', delay.toFixed(0) + 'ms');

        p.appendChild(span);
      });
    }

    const puzzles = document.querySelectorAll('p.puzzle');
    puzzles.forEach(buildPuzzleParagraph);

    const io = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          io.unobserve(entry.target);
        }
      });
    }, { threshold: 0.25 });

    puzzles.forEach(p => io.observe(p));
  </script>
</body>
</html>
